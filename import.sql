\copy (select y.tax_key, (house_number_low || ' ' || street_direction || ' ' || street || ' ' || street_type) as address, zip_code as zip, 'Milwaukee' as "city",ST_Y(ST_Centroid(s.geom)) as lat, ST_X(ST_Centroid(s.geom)) as lon, year_built, zoning, geo_alder, 0 as "tweeted" from (  select max(z.tax_key) as tax_key from (    select max(tax_key) as tax_key from assessments a join shapefiles s on s.taxkey = a.tax_key where year = 2022 and zip_code is NOT NULL and s.geom IS NOT NULL group by (house_number_low || ' ' || street_direction || ' ' || street || ' ' || street_type) ) z join assessments a on a.tax_key = z.tax_key and a.year = 2022 join shapefiles s on s.taxkey = z.tax_key group by s.geom) y join assessments a on a.tax_key = y.tax_key and a.year = 2022 join shapefiles s on s.taxkey = y.tax_key) to './data.csv' csv header;
